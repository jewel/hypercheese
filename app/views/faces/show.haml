%h1 Face
%img.main-face{ src: @face.url }
%a(href="/items/#{@face.item_id}")
  %img.source-image{ src: @face.item.resized_url(:large) }
%br
%strong= @face.cluster&.tag&.label

= form_with(method: "POST", url: "/faces/#{@face.id}/canonize") do |f|
  = f.text_field :label, placeholder: "Tag label"
  %br
  %button.btn.btn-default(type="submit") Canonize

- if @face.tag
  %h1 Canonical for #{@face.tag.label}
  %a.btn.btn-default(href="/faces/#{@face.id}/uncanonize" data-method="POST")
    Uncanonize Face

  %ul
    %li
      %a{ href: "/faces/mistagged/#{@face.tag.id}" }
        Mistagged
    %li
      %a{ href: "/faces/untagged/#{@face.tag.id}" }
        Untagged

- if @other_canonical&.size&.> 0
  %h2 Other Canonical Faces with this Tag
  .face-list
    - @other_canonical.each do |face|
      .face
        %a(href="/faces/#{face.id}")
          %img{ src: face.url }

- unless @face.embedding?
  %p No embedding for face

%h2 Similar Faces
.face-list
  - @canonical_faces.each do |canon|
    - next unless canon.embedding?
    - next unless @face.embedding?
    .face
      %a(href="/faces/#{canon.id}")
        %img{ src: canon.url }
      %br
      %strong= canon.tag.label
      %br
      = "#{(@face.distance(canon)*100).round(1)}%"

- if @cluster
  %h2 #{@cluster.size} Faces in Cluster
  .face-list
    - @cluster.each do |other|
      - next unless other.embedding?
      - next unless @face.embedding?
      .face
        %a(href="/faces/#{other.id}")
          %img{ src: other.url }
        %br
        = "#{(other.similarity*100).round(1)}%"
